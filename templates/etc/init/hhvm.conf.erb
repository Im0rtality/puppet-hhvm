# hhvm - HipHop VM
#
# The HipHopVM server provides a high performance PHP stack and web server.

description     "HHVM server"
author "Yermo Lamers http://twitter.com/yermolamers"

start on filesystem or runlevel [2345]
stop on runlevel [!2345]

respawn
respawn limit 10 5
umask 022
limit nofile <%= scope.lookupvar('hhvm::limit') %> <%= scope.lookupvar('hhvm::limit') %>

post-stop script
    /bin/rm -f <%= scope.lookupvar('hhvm::service::pid') %> <%= scope.lookupvar('hhvm::service::socket') %>
end script

# Location of config and executable

env SERVER=<%= scope.lookupvar('hhvm::path_to_hhvm') %>
env CONFIG_FILE="<%= scope.lookupvar('hhvm::service::server_ini') %>"
env SYSTEM_CONFIG_FILE="<%= scope.lookupvar('hhvm::service::php_ini') %>"
env HDF_CONFIG_FILE="<%= scope.lookupvar('hhvm::service::config_hdf') %>"
env RUN_AS=www-data
exec $SERVER -m daemon --config $CONFIG_FILE --config $SYSTEM_CONFIG_FILE --config $HDF_CONFIG_FILE --user $RUN_AS
